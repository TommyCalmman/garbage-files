import numpy as np
import os
import cv2 as cv

test_ir = '''[25.829126, 26.030573, 25.730494, 26.30578, 26.413141, 26.496912, 26.36297, 26.702204, 26.315943, 26.579523, 26.961145, 26.771997, 26.540613, 26.576136, 26.883356, 26.672327, 26.4667, 26.715296, 26.782068, 27.059198, 26.681208, 26.376245, 26.420801, 26.28573; 25.950617, 25.879053, 26.552668, 26.470331, 26.751276, 26.405207, 26.896173, 26.62948, 26.747217, 26.695124, 26.926477, 26.809412, 26.918299, 26.799006, 26.845331, 26.9667, 27.188684, 26.783197, 26.893152, 26.466883, 26.832331, 26.4349, 26.524591, 26.579645; 26.373285, 27.851923, 26.710993, 28.088892, 26.995813, 28.177698, 27.372248, 28.502039, 27.248163, 28.350153, 27.22912, 28.624872, 27.676264, 28.552881, 27.290888, 28.724054, 27.570307, 28.7857, 27.223749, 28.26626, 27.03689, 28.436243, 27.209528, 28.254084; 26.654047, 26.581873, 26.571253, 26.149439, 26.859247, 26.963953, 27.163416, 27.017176, 26.884394, 26.983149, 26.990442, 27.047602, 27.182917, 27.48559, 27.250147, 27.359339, 27.420435, 27.069391, 26.989649, 27.239374, 27.057947, 26.654627, 27.16128, 26.903254; 26.644709, 26.779139, 26.488367, 26.766565, 26.711023, 26.595667, 27.147852, 27.188257, 27.136896, 26.98263, 27.177607, 26.998926, 27.030848, 26.858698, 27.298304, 26.884516, 27.08819, 27.116541, 27.113245, 27.142328, 27.032129, 26.813959, 26.566187, 26.709223; 26.842035, 26.419611, 26.938593, 26.846003, 26.965448, 26.862421, 27.204432, 27.093042, 27.142572, 27.03161, 27.500849, 27.206171, 27.450769, 26.977594, 27.250299, 27.28512, 27.300043, 27.043818, 27.247278, 27.098383, 27.310633, 26.942926, 27.06988, 26.932306; 26.710779, 27.757441, 27.049891, 28.368494, 27.093561, 28.518976, 27.308954, 28.143, 27.558802, 28.521601, 27.415461, 28.732935, 27.711481, 28.489069, 27.821558, 28.774714, 27.741693, 28.741419, 27.656153, 28.639582, 27.815027, 28.860529, 27.681452, 28.544367; 26.827173, 26.751123, 27.075312, 26.809961, 26.995325, 27.041529, 27.446863, 27.087397, 27.260523, 27.341669, 27.372034, 27.469995, 27.264765, 27.347437, 27.435511, 27.470606, 27.450891, 27.312525, 27.611322, 27.454248, 27.39596, 27.267084, 27.100519, 27.127802; 26.903894, 26.871088, 26.963831, 27.019129, 27.033045, 27.078241, 27.210901, 27.056238, 27.086481, 27.236078, 27.09762, 26.946161, 27.494959, 27.001307, 27.027887, 27.234766, 27.225611, 27.236017, 27.165796, 27.175714, 27.263971, 27.10589, 26.699701, 26.901728; 26.922052, 26.736506, 27.033472, 26.773584, 27.267206, 27.197992, 27.281122, 27.376123, 27.262934, 27.008692, 27.119196, 27.373621, 27.361994, 26.97146, 27.242975, 27.118708, 27.171198, 27.228601, 27.359522, 27.092524, 27.202234, 26.919214, 27.102961, 26.788172; 27.070673, 28.10885, 27.457331, 28.664728, 27.516321, 28.493525, 27.642176, 28.25503, 27.464228, 28.211481, 27.373072, 28.306726, 27.335413, 28.038813, 27.380671, 28.116724, 27.288385, 28.395472, 27.293238, 28.439417, 27.711725, 28.521235, 27.596521, 28.362329; 26.861963, 26.873255, 26.830194, 26.939844, 27.16958, 27.368067, 27.214563, 27.234339, 27.150995, 26.886591, 27.135859, 27.051691, 27.175653, 27.046198, 27.251429, 26.938623, 27.014399, 27.235193, 27.541285, 27.215357, 27.383753, 27.436365, 27.41366, 27.267084; 26.831171, 26.993311, 27.303308, 27.156397, 27.350763, 27.233576, 27.436396, 26.940729, 26.960047, 26.996546, 26.849817, 26.903284, 26.765589, 26.821711, 26.866114, 26.674982, 26.791193, 26.64123, 27.122339, 26.947565, 26.909693, 27.314386, 26.95257, 26.977198; 27.151819, 26.984217, 27.26333, 27.181482, 27.27743, 27.179193, 27.290461, 26.870142, 27.079157, 26.837214, 26.987207, 26.910334, 26.940454, 26.671289, 26.876673, 26.629297, 26.867945, 26.765223, 26.963984, 27.193384, 27.121241, 26.839777, 27.040613, 27.126551; 27.187281, 28.272333, 27.403498, 28.375147, 27.446527, 28.360132, 27.55456, 28.140314, 27.271112, 27.995752, 27.302759, 28.020166, 27.133142, 28.01153, 27.391382, 27.939386, 27.11236, 28.170038, 27.571192, 28.127924, 27.407526, 28.552271, 27.627314, 28.558344; 26.918543, 26.98031, 27.271753, 27.011591, 27.266779, 27.291895, 27.259455, 27.177485, 27.306574, 26.879511, 27.119928, 26.817926, 26.851465, 27.092554, 26.978022, 27.013788, 26.677851, 26.721094, 27.104639, 27.143152, 27.00326, 27.031305, 27.315149, 27.119165; 26.928156, 26.916132, 27.216059, 26.790003, 27.065149, 27.285608, 26.916651, 26.75918, 26.798212, 27.005732, 26.72558, 26.945856, 26.607294, 26.627771, 26.830896, 26.453577, 26.932459, 26.786554, 27.030603, 27.064569, 26.808771, 26.815668, 27.059473, 26.706751; 27.347315, 27.014063, 27.122004, 27.051722, 27.211603, 27.155512, 27.125299, 27.059992, 27.103052, 26.831476, 26.699579, 26.79513, 26.733606, 26.645899, 26.940454, 26.670984, 27.37002, 26.916315, 27.315149, 27.242853, 27.465021, 27.023462, 27.031214, 26.707697; 27.320002, 28.128778, 27.237116, 28.21612, 27.462122, 28.39596, 27.365839, 28.2969, 27.239954, 28.168634, 27.249689, 27.992365, 27.445093, 28.161249, 27.339777, 28.400873, 27.82873, 28.73678, 27.867517, 29.176477, 28.263605, 29.236597, 27.984064, 29.182337; 26.80221, 26.655146, 26.790766, 27.25802, 27.12417, 27.217096, 27.485498, 27.074488, 27.134241, 27.075403, 26.814508, 26.730585, 26.891809, 26.972925, 27.048365, 27.309351, 27.538507, 27.399836, 27.830866, 27.873499, 28.110651, 27.804712, 28.101862, 28.144617; 26.968439, 26.965723, 27.10058, 26.831232, 26.943232, 27.183558, 27.03863, 26.94906, 27.006647, 26.919458, 26.989313, 27.051813, 26.950037, 27.118433, 27.307123, 27.706476, 27.847193, 27.702173, 27.633997, 27.857019, 27.855463, 28.224878, 28.126215, 28.197138; 27.08993, 26.958033, 26.83523, 26.965693, 27.316553, 26.906824, 27.188623, 27.131342, 26.960993, 27.187372, 27.291224, 27.014948, 27.29159, 27.17251, 27.423853, 27.456141, 27.84643, 27.896692, 27.952784, 27.876184, 27.801844, 27.90243, 27.963617, 27.872644; 26.897455, 27.720057, 27.145685, 27.816553, 27.374018, 28.174341, 27.378626, 28.16897, 27.434351, 28.7279, 27.748407, 28.51446, 27.761957, 28.533014, 27.968958, 29.235987, 28.571894, 29.485651, 28.878809, 29.652948, 28.291101, 29.08581, 28.618616, 29.437922; 26.988977, 26.581598, 26.812403, 26.590815, 27.013971, 26.951593, 27.189631, 27.283045, 27.355799, 27.243799, 27.531336, 27.610346, 27.445826, 27.548548, 27.743189, 27.961023, 28.061609, 28.119684, 28.628077, 28.316065, 28.376123, 28.057245, 28.07934, 28.120356; 26.30517, 26.511713, 26.69256, 26.466822, 26.720362, 26.626032, 27.10113, 26.827631, 27.392756, 27.277124, 27.306971, 27.411432, 27.484308, 27.185053, 27.619684, 27.82464, 27.8211, 28.229822, 27.847651, 27.562983, 27.894617, 27.752619, 27.830622, 27.600885; 26.452539, 26.294184, 26.650263, 26.55337, 26.820551, 26.781855, 27.064692, 27.165796, 27.280817, 27.403162, 27.759943, 27.520136, 27.55578, 27.256342, 27.580835, 28.03454, 28.402765, 28.281092, 28.075678, 27.938074, 27.948999, 27.799463, 27.556269, 27.966242; 26.301477, 27.442438, 26.475245, 27.861506, 27.020472, 28.068995, 27.292933, 28.136255, 27.437952, 28.804499, 27.570642, 28.555628, 27.7904, 28.611292, 28.019068, 29.192133, 28.42486, 29.435205, 28.547327, 29.229486, 28.529078, 29.419306, 28.284204, 29.384485; 26.345819, 26.175531, 26.592585, 26.490137, 26.478083, 26.8323, 27.184809, 26.874567, 27.193476, 27.352503, 27.741114, 27.493555, 27.58349, 27.485315, 28.033503, 27.938868, 28.186152, 28.016443, 28.341242, 28.176874, 27.703394, 27.932398, 27.909998, 27.939417; 26.094141, 25.736933, 26.125605, 26.060968, 26.800196, 26.519953, 26.95257, 26.591669, 26.812922, 26.712, 26.895929, 26.978022, 26.875849, 27.330378, 27.079889, 27.13711, 27.53631, 27.400385, 27.619837, 27.262842, 27.413965, 27.169031, 26.926691, 27.181757; 26.324152, 25.85705, 26.320215, 26.004633, 26.54104, 26.64889, 26.719568, 26.432795, 26.673365, 26.558008, 26.985437, 26.755762, 27.187494, 27.074152, 27.353083, 27.26095, 27.510706, 27.435389, 27.614038, 27.654779, 27.521753, 27.346186, 27.37649, 27.341211; 25.758356, 27.072321, 26.021448, 27.429621, 26.327356, 27.338251, 26.556879, 27.601526, 27.071436, 27.813532, 26.971491, 27.912592, 27.031702, 28.120142, 27.498621, 28.507532, 27.674219, 28.687189, 27.43017, 28.620966, 27.614679, 27.930628, 27.323633, 28.130823; 25.443995, 25.230158, 25.81106, 25.992243, 26.585932, 26.241938, 26.808466, 26.729273, 26.870417, 26.573786, 26.779627, 26.911585, 26.97027, 26.881433, 27.080286, 27.118341, 27.372858, 27.483271, 27.352259, 27.138788, 27.08639, 27.08349, 26.682123, 26.656244]'''



class VideoCamera(object):
    def __init__(self):
        self.video = cv.VideoCapture(0)
        #self.video = cv.VideoCapture("http://192.168.2.92:8888/bgr")
        #self.video = cv2.VideoCapture("http://192.168.1.10:8888/bgr")
        #self.video = cv2.VideoCapture("tcp://admin:admin@176.100.76.144:37777/cam/realmonitor?channel=0&subtype=0")

    def __del__(self):
        self.video.release()

    def get_frame(self):
        success, frame = self.video.read()
        print(frame)
        if success:
            ret, jpeg = cv.imencode('.jpg', frame)
            return jpeg.tobytes()
    
    def get_ir(self, ir_array):
        ir_array = ir_array.replace('[', '')
        ir_array = ir_array.replace(']', '')
        ir_array = ir_array.replace(',', '')
        ir_array = ir_array.replace(';', '')
        ir_array = ir_array.replace('\n', ' ')
        arr = np.array(ir_array.split(' '))
        arr = arr[arr != '']
        arr = arr.astype(np.float64)
        ir_matrix = arr.reshape(24, 32)
        ir_matrix = cv.normalize(ir_matrix, None, 0, 255, cv.NORM_MINMAX)
        ir_matrix = np.uint8(ir_matrix)
        ir_matrix = cv.resize(ir_matrix, (240, 320), cv.INTER_CUBIC)
        ir_matrix = cv.applyColorMap(ir_matrix, cv.COLORMAP_JET)
        suc, img_buff_arr = cv.imencode(".jpg", ir_matrix)
        return img_buff_arr.tobytes()


if __name__ == '__main__':
    asd = VideoCamera()
    color_img = asd.get_ir(test_ir)
    with open('t.png','wb') as f:
        f.write(color_img)